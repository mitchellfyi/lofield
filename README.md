# Lofield FM

**Background noise for people just trying to make it through the day.**

Lofield FM is a fictional local radio station for the made-up town of Lofield—a community of remote workers, freelancers, and digital nomads all trying to stay sane between video calls. Everything you hear on Lofield FM is generated by AI: the lofi music, the presenters, the station idents, even the local weather reports for a town that doesn't exist.

## What is Lofield FM?

Lofield FM is an experimental AI-powered radio station that combines:

- **AI-generated lofi music** tailored to the time of day and mood
- **AI presenters** with distinct personalities who chat between tracks
- **Listener requests** moderated and upvoted by the community
- **Seasonal and holiday programming** that adapts to the calendar
- **A consistent fictional world** with running jokes and local landmarks

The station runs 24/7 with a rotating schedule of shows, each with its own vibe and talk-to-music ratio. Presenters work in duos and hand over to each other with brief five-minute crossover segments.

## Core Concept

Think of Lofield FM as your co-working companion. It's not here to motivate you or solve your problems—it's just here, playing chill beats and occasionally acknowledging that yes, your Wi-Fi probably *is* worse than everyone else's, and yes, that meeting could have been an email.

The humour is dry, self-deprecating, and occasionally dark (but never cruel). The music is always lofi. The town of Lofield is always stuck in roadworks. And the presenters are always there, like that colleague you don't really talk to but nod at in the break room.

## How It Works

1. **Music Generation**: Listener requests are normalized by an LLM and fed to a text-to-music AI model that generates lofi tracks on demand
2. **Presenter Commentary**: AI DJs introduce tracks, read out requests, and riff on life in Lofield using text-to-speech
3. **Request System**: Listeners submit song ideas that get moderated, classified, and upvoted by the community
4. **Playout Engine**: A scheduling system queues tracks and presenter segments, maintaining the right talk/music balance for each show
5. **Archiving**: Past shows are stored and available through a "rewind" feature

## Project Structure

```
lofield/
├── README.md                 # This file
├── BACKEND.md                # Backend services documentation
├── web/                      # Next.js 16 frontend & API
│   ├── app/                  # Next.js app directory
│   │   ├── api/              # API routes (requests, now-playing, queue, etc.)
│   │   └── ...               # Pages and components
│   ├── lib/                  # Utilities and database client
│   ├── prisma/               # Database schema and migrations
│   └── ...
├── services/                 # Backend services
│   └── scheduler/            # Content generation scheduler
├── config/                   # Station configuration files
│   ├── station.json         # Global station settings
│   ├── presenters.json      # All presenter definitions
│   ├── tags.json            # Topic and holiday tags
│   └── shows/               # Individual show configurations (8 files)
├── schemas/                  # Configuration schema documentation
├── scripts/                  # Validation and utility scripts
└── docs/
    ├── architecture.md       # Technical pipeline overview
    ├── contributing.md       # How to contribute
    ├── schedule.md           # 24-hour programming schedule
    ├── style_guide.md        # Voice, tone, and content guidelines
    └── town_bible.md         # Lofield town lore and landmarks
```

## Tech Stack

### Backend
- **Framework**: Next.js 16 API Routes (TypeScript)
- **Database**: PostgreSQL with Prisma ORM
- **Real-time**: Server-Sent Events for live updates
- **Scheduler**: Node.js service for content generation
- **Streaming**: Icecast (or Node-based alternative)

See [BACKEND.md](BACKEND.md) for comprehensive backend documentation.

## Getting Started

This project is currently in development.

### Docker Setup (Recommended)

The easiest way to run Lofield FM is using Docker. This approach handles all dependencies and services automatically.

**Prerequisites**:
- [Docker](https://docs.docker.com/get-docker/) (version 20.10+)
- [Docker Compose](https://docs.docker.com/compose/install/) (version 2.0+)
- API keys for AI services (OpenAI, Replicate)

**Quick start**:
```bash
# 1. Set up environment
cp .env.docker .env

# 2. Edit .env and set required values:
#    - POSTGRES_PASSWORD
#    - ICECAST_*_PASSWORD (3 passwords)
#    - OPENAI_API_KEY
#    - REPLICATE_API_TOKEN

# 3. Start all services
docker-compose up --build -d

# 4. Run database migrations
docker-compose exec web npx prisma migrate deploy

# 5. Seed the database
docker-compose exec web npx tsx prisma/seed/seed.ts
```

Access the application:
- **Web UI**: http://localhost:3000
- **Live Stream**: http://localhost:8000/lofield
- **Icecast Admin**: http://localhost:8000/admin/

For comprehensive Docker documentation, see [DOCKER.md](DOCKER.md).

### Manual Setup (Alternative)

If you prefer to run services manually without Docker:

#### Frontend Development

The web frontend is built with Next.js 16 and lives in the `web/` directory.

**Installation**:
```bash
cd web
npm install
```

**Development**:
```bash
npm run dev
```
Then open [http://localhost:3000](http://localhost:3000) in your browser.

**Building for production**:
```bash
npm run build
npm start
```

**Linting and formatting**:
```bash
npm run lint
npm run format
```

#### Backend Development

The backend uses Next.js API Routes with Prisma and PostgreSQL. See [BACKEND.md](BACKEND.md) for full documentation.

**Quick start**:
```bash
# Set up secure credentials first (IMPORTANT!)
# Copy the example files and set secure passwords
cp .env.example .env
cd web
cp .env.example .env

# Edit both .env files with secure credentials
# For development, you can use simple passwords, but NEVER use defaults in production
# Generate secure passwords with: openssl rand -base64 32

# Start database services
cd ..
docker-compose up -d postgres icecast

cd web
# Install dependencies
npm install

# Generate Prisma client
npx prisma generate

# Run migrations
npx prisma migrate dev

# Seed the database
npx tsx prisma/seed/seed.ts

# Start development server (includes API)
npm run dev
```

**⚠️ Security Note**: Never commit `.env` files with real credentials. The `.env.example` files contain placeholder values that MUST be changed before use. Always use strong, unique passwords in production environments.

**API Endpoints**:
- `GET/POST /api/requests` - Submit and list requests
- `POST /api/requests/{id}/vote` - Upvote requests
- `GET /api/now-playing` - Current segment metadata
- `GET /api/queue` - Upcoming segments
- `GET /api/archive` - Past broadcasts
- `GET /api/events` - Real-time updates via SSE

**Database Management**:
```bash
# View/edit data in Prisma Studio
npx prisma studio

# Create new migration
npx prisma migrate dev --name <migration_name>
```

**Scheduler Service**:
```bash
cd services/scheduler
npx tsx index.ts
```

**Dynamic Show Pages**: The app includes dynamic routes for each show at `/[slug]` (e.g., `/morning_commute`, `/afternoon_push`). These pages use:
- **`generateStaticParams`** to pre-generate pages for all 8 shows at build time
- **`generateMetadata`** for SEO-optimized titles and descriptions per show
- **`notFound()`** to display a friendly 404 page for invalid show slugs

**Error Handling**: Custom error pages provide a polished experience:
- **`app/not-found.tsx`** - Friendly 404 page with Lofield FM humor
- **`app/error.tsx`** - Error boundary for unexpected runtime errors

**Styling**: The app uses Tailwind CSS v4 with the `@tailwindcss/postcss` plugin configured in `postcss.config.mjs`.

### Configuration

**Configuration**: The station is defined by JSON configuration files in the `config/` directory. See [config/README.md](config/README.md) for an overview of the configuration system.

**Technical details**: For information about how the AI pipeline works, see [docs/architecture.md](docs/architecture.md).

**Voice and tone**: To understand the station's voice and humour, read [docs/style_guide.md](docs/style_guide.md).

To learn about the fictional world of Lofield, check out [docs/town_bible.md](docs/town_bible.md).

## Contributing

We welcome contributions! Whether you want to propose a new show, improve the AI prompts, or fix bugs, see [docs/contributing.md](docs/contributing.md) for guidelines.

## License

This project is experimental and educational. All AI-generated content is created on-the-fly and not stored permanently (except in archives).

---

*Lofield FM: Now playing on a frequency that probably doesn't exist.*
